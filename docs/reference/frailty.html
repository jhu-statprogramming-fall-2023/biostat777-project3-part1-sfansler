<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The frailty function allows one to add a simple random effects term to
a Cox model."><title>Random effects terms — frailty • survival</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Random effects terms — frailty"><meta property="og:description" content="The frailty function allows one to add a simple random effects term to
a Cox model."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-analysis.html">Example Analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/therneau/survival/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Random effects terms</h1>
      
      <div class="d-none name"><code>frailty.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The frailty function allows one to add a simple random effects term to
a Cox model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">frailty</span><span class="op">(</span><span class="va">x</span>, distribution<span class="op">=</span><span class="st">"gamma"</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">frailty.gamma</span><span class="op">(</span><span class="va">x</span>, sparse <span class="op">=</span> <span class="op">(</span><span class="va">nclass</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">theta</span>, <span class="va">df</span>, eps <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>         method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"em"</span>,<span class="st">"aic"</span>, <span class="st">"df"</span>, <span class="st">"fixed"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> </span>
<span><span class="fu">frailty.gaussian</span><span class="op">(</span><span class="va">x</span>, sparse <span class="op">=</span> <span class="op">(</span><span class="va">nclass</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">theta</span>, <span class="va">df</span>,</span>
<span>         method <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reml"</span>,<span class="st">"aic"</span>, <span class="st">"df"</span>, <span class="st">"fixed"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">frailty.t</span><span class="op">(</span><span class="va">x</span>, sparse <span class="op">=</span> <span class="op">(</span><span class="va">nclass</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">theta</span>, <span class="va">df</span>, eps <span class="op">=</span> <span class="fl">1e-05</span>, tdf <span class="op">=</span> <span class="fl">5</span>,</span>
<span>         method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aic"</span>, <span class="st">"df"</span>, <span class="st">"fixed"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>the variable to be entered as a random effect.  
    It is always treated as a factor.</p></dd>

  <dt>distribution</dt>
<dd><p>either the <code>gamma</code>, 
    <code>gaussian</code> or <code>t</code>
    distribution may be specified.
    The routines <code>frailty.gamma</code>,
    <code>frailty.gaussian</code> and 
    <code>frailty.t</code> do the actual work.</p></dd>

  <dt>...</dt>
<dd><p>Arguments for specific distribution, including (but not
    limited to)</p></dd>

  <dt>sparse</dt>
<dd><p>cutoff for using a sparse coding of the data matrix.  
    If the total number of levels of <code>x</code> is larger
    than this value, then a sparse matrix approximation is used.
    The correct cutoff is still a matter of exploration: if the number of
    levels is very large (thousands) then the non-sparse calculation may not be
    feasible in terms of both memory and compute time.
    Likewise, the accuracy of the sparse approximation appears to be related to
    the maximum proportion of subjects in any one class, being best when no
    one class has a large membership.</p></dd>

  <dt>theta</dt>
<dd><p>if specified, this fixes the variance of the random effect.
    If not, the variance is a parameter, and a best solution is sought.
    Specifying this implies <code>method='fixed'</code>.</p></dd>

  <dt>df</dt>
<dd><p>if specified, this fixes the degrees of freedom for the random effect.
    Specifying this implies <code>method='df'</code>.
    Only one of <code>theta</code> or 
    <code>df</code> should be specified.</p></dd>

  <dt>method</dt>
<dd><p>the method used to select a solution for theta, the variance of the
    random effect.  
    The <code>fixed</code> corresponds to a user-specified
    value, and no iteration is done.
    The <code>df</code> selects the variance such that the
    degrees of freedom for the random effect matches a user specified value.
    The <code>aic</code> method seeks to 
    maximize Akaike's information criteria 
    2*(partial likelihood - df).
    The <code>em</code> and <code>reml</code>
    methods are specific to Cox models with gamma and gaussian random effects,
    respectively.
    Please see further discussion below.</p></dd>

  <dt>tdf</dt>
<dd><p>the degrees of freedom for the t-distribution.</p></dd>

  <dt>eps</dt>
<dd><p>convergence criteria for the iteration on theta.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>this function is used in the model statement of either
<code>coxph</code> or <code>survreg</code>.
It's results are used internally.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>frailty</code> plugs into the general penalized
modeling framework provided by the <code>coxph</code> 
and <code>survreg</code> routines.  
This framework deals with likelihood, penalties, and degrees of freedom;
these aspects work well with either parent routine.</p>
<p>Therneau, Grambsch, and Pankratz show how maximum likelihood estimation for
the Cox model with a gamma frailty can be accomplished using a general
penalized routine, and Ripatti and Palmgren work through a similar argument
for the Cox model with a gaussian frailty.  Both of these are specific to
the Cox model.  
Use of gamma/ml or gaussian/reml with 
<code>survreg</code> does not lead to valid results.</p>
<p>The extensible structure of the penalized methods is such that the penalty
function, such as <code>frailty</code> or
<code>pspine</code>, is completely separate from the modeling
routine.  The strength of this is that a user can plug in any penalization
routine they choose.  A weakness is that it is very difficult for the
modeling routine to know whether a sensible penalty routine has been
supplied.</p>
<p>Note that use of a frailty term implies a mixed effects model and use of
a cluster term implies a GEE approach; these cannot be mixed.</p>
<p>The <code>coxme</code> package has superseded
this method.  It is faster, more stable, and more flexible.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>S Ripatti and J Palmgren, Estimation of multivariate frailty 
models using penalized partial likelihood,
Biometrics, 56:1016-1022, 2000.</p>
<p>T Therneau, P Grambsch and VS Pankratz,
Penalized survival models and frailty,
J Computational and Graphical Statistics, 12:156-175, 2003.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="coxph.html">coxph</a>, <a href="survreg.html">survreg</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Random institutional effect</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="fu">frailty</span><span class="op">(</span><span class="va">inst</span>, df<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = Surv(time, status) ~ age + frailty(inst, df = 4), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          coef se(coef)     se2   Chisq   DF     p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age                   0.01937  0.00933 0.00925 4.31149 1.00 0.038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> frailty(inst, df = 4)                          3.33459 3.99 0.501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iterations: 3 outer, 10 Newton-Raphson</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Variance of random effect= 0.038   I-likelihood = -743.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Degrees of freedom for terms= 1 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test=9.96  on 4.97 df, p=0.08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n= 227, number of events= 164 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (1 observation deleted due to missingness)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Litter effects for the rats data</span></span></span>
<span class="r-in"><span><span class="va">rfit2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="fu">frailty.gaussian</span><span class="op">(</span><span class="va">litter</span>, df<span class="op">=</span><span class="fl">13</span>, sparse<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, <span class="va">rats</span>,</span></span>
<span class="r-in"><span>                  subset<span class="op">=</span> <span class="op">(</span><span class="va">sex</span><span class="op">==</span><span class="st">'f'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rfit2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="fu">frailty.gaussian</span><span class="op">(</span><span class="va">litter</span>, df<span class="op">=</span><span class="fl">13</span>, sparse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="va">rats</span>,</span></span>
<span class="r-in"><span>                  subset<span class="op">=</span> <span class="op">(</span><span class="va">sex</span><span class="op">==</span><span class="st">'f'</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Terry M Therneau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

