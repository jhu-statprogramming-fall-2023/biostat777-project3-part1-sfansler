<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A common task in medical work is to find the closest lab value to some
  index date, for each subject."><title>Find the index of the closest value in data set 2, for each entry in
  data set one. — neardate • survival</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find the index of the closest value in data set 2, for each entry in
  data set one. — neardate"><meta property="og:description" content="A common task in medical work is to find the closest lab value to some
  index date, for each subject."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-analysis.html">Example Analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/therneau/survival/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Find the index of the closest value in data set 2, for each entry in
  data set one.</h1>
      
      <div class="d-none name"><code>neardate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A common task in medical work is to find the closest lab value to some
  index date, for each subject.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">neardate</span><span class="op">(</span><span class="va">id1</span>, <span class="va">id2</span>, <span class="va">y1</span>, <span class="va">y2</span>, best <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"after"</span>, <span class="st">"prior"</span><span class="op">)</span>,</span>
<span>nomatch <span class="op">=</span> <span class="cn">NA_integer_</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>id1</dt>
<dd><p>vector of subject identifiers for the index group</p></dd>

  <dt>id2</dt>
<dd><p>vector of identifiers for the reference group</p></dd>

  <dt>y1</dt>
<dd><p>normally a vector of dates for the index group,
    but any orderable data type is allowed</p></dd>

  <dt>y2</dt>
<dd><p>reference set of dates</p></dd>


  <dt>best</dt>
<dd><p>if <code>best='prior'</code> find the index of the first
    y2 value less than or equal to
    the target y1 value, for each subject.
    If <code>best='after'</code> find the first y2 value which is greater than
    or equal to the target y1 value, for each subject.</p></dd>


  <dt>nomatch</dt>
<dd><p>the value to return for items without a match</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This routine is closely related to <code>match</code> and to
  <code>findInterval</code>, the first of which finds exact matches and
  the second closest matches.  This finds the closest matching date
  within sets of exactly matching identifiers.  
  Closest date matching is often needed in clinical studies.  For
  example data set 1 might contain the subject identifier and the date
  of some procedure and data set set 2 has the dates and values for
  laboratory tests, and the query is to find the first
  test value after the intervention but no closer than 7 days.</p>
<p>The <code>id1</code> and <code>id2</code> arguments are similar to <code>match</code> in
  that we are searching for instances of <code>id1</code> that will be found
  in <code>id2</code>, and the result is the same length as <code>id1</code>.
  However, instead of returning the first match with <code>id2</code> this
  routine returns the one that best matches with respect to <code>y1</code>.</p>
<p>The <code>y1</code> and <code>y2</code> arguments need not be dates, the function
  works for any data type such that the expression
  <code>c(y1, y2)</code> gives a sensible, sortable result.
  Be careful about matching Date and DateTime values and the impact of
  time zones, however, see <code><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></code>. 
  If <code>y1</code> and <code>y2</code> are not of the same class the user is
  on their own.
  Since there exist pairs of unmatched data types where the result could
  be sensible, the routine will in this case proceed under the assumption
  that "the user knows what they are doing".  Caveat emptor.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>the index of the matching observations in the second data set, or
  the <code>nomatch</code> value for no successful match</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Terry Therneau</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></code>, <code><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                    entry.dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"2011"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="st">"5"</span>, sep<span class="op">=</span><span class="st">'-'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">6</span>,<span class="fl">9</span>, <span class="fl">2</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">12</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    lab.dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"2011"</span>, <span class="va">temp1</span>, <span class="st">"1"</span>, sep<span class="op">=</span><span class="st">'-'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    chol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">130</span>, <span class="fl">280</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#first cholesterol on or after enrollment</span></span></span>
<span class="r-in"><span><span class="va">indx1</span> <span class="op">&lt;-</span> <span class="fu">neardate</span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">id</span>, <span class="va">data2</span><span class="op">$</span><span class="va">id</span>, <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span>, <span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data2</span><span class="op">[</span><span class="va">indx1</span>, <span class="st">"chol"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 165 180  NA 232 256 225  NA  NA  NA 201</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Closest one, either before or after. </span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="va">indx2</span> <span class="op">&lt;-</span> <span class="fu">neardate</span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">id</span>, <span class="va">data2</span><span class="op">$</span><span class="va">id</span>, <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span>, <span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span>, </span></span>
<span class="r-in"><span>                   best<span class="op">=</span><span class="st">"prior"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">indx1</span><span class="op">)</span>, <span class="va">indx2</span>, <span class="co"># none after, take before</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">indx2</span><span class="op">)</span>, <span class="va">indx1</span>, <span class="co">#none before</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">[</span><span class="va">indx2</span><span class="op">]</span><span class="op">-</span> <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span><span class="op">)</span> <span class="op">&lt;</span></span></span>
<span class="r-in"><span>              <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">[</span><span class="va">indx1</span><span class="op">]</span><span class="op">-</span> <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span><span class="op">)</span>, <span class="va">indx2</span>, <span class="va">indx1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  5 NA  6  9 11 NA 13 14 15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># closest date before or after, but no more than 21 days prior to index</span></span></span>
<span class="r-in"><span><span class="va">indx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span> <span class="op">-</span> <span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">[</span><span class="va">indx2</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span><span class="fl">21</span>, <span class="cn">NA</span>, <span class="va">indx2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">indx1</span><span class="op">)</span>, <span class="va">indx2</span>, <span class="co"># none after, take before</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">indx2</span><span class="op">)</span>, <span class="va">indx1</span>, <span class="co">#none before</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">[</span><span class="va">indx2</span><span class="op">]</span><span class="op">-</span> <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span><span class="op">)</span> <span class="op">&lt;</span></span></span>
<span class="r-in"><span>              <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">lab.dt</span><span class="op">[</span><span class="va">indx1</span><span class="op">]</span><span class="op">-</span> <span class="va">data1</span><span class="op">$</span><span class="va">entry.dt</span><span class="op">)</span>, <span class="va">indx2</span>, <span class="va">indx1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  5 NA  6  9 11 NA NA NA 15</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Terry M Therneau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

