<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Produce pseudo values from a survival curve."><title>Pseudo values for survival. — pseudo • survival</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pseudo values for survival. — pseudo"><meta property="og:description" content="Produce pseudo values from a survival curve."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-analysis.html">Example Analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/therneau/survival/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pseudo values for survival.</h1>
      
      <div class="d-none name"><code>pseudo.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produce pseudo values from a survival curve.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pseudo</span><span class="op">(</span><span class="va">fit</span>, <span class="va">times</span>, <span class="va">type</span>, addNA<span class="op">=</span><span class="cn">TRUE</span>, data.frame<span class="op">=</span><span class="cn">FALSE</span>, minus1<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fit</dt>
<dd><p>a <code>survfit</code> object, or one that inherits that class.</p></dd>

  <dt>times</dt>
<dd><p>a vector of time points, at which to evaluate the pseudo values.</p></dd>

  <dt>type</dt>
<dd><p>the type of value, either the probabilty in state <code>pstate</code>,
    the cumulative hazard <code>cumhaz</code> or the expected sojourn time in
    the state <code>sojourn</code>.</p></dd>

  <dt>addNA</dt>
<dd><p>If any observations were removed due to missing values
    in the <code>fit</code> object, add those rows (as NA) into the return.
    This causes the result of pseudo to match the original dataframe.</p></dd>

  <dt>data.frame</dt>
<dd><p>if TRUE, return the data in "long" form as a
    data.frame with id, time, and pseudo as variables.</p></dd>

  <dt>minus1</dt>
<dd><p>use n-1 as the multiplier rather than n</p></dd>
</dl><p>.</p>
<dl><dt>...</dt>
<dd><p>other arguments to the <code>residuals.survfit</code> function, which does
 the majority of the work, e.g., <code>collapse</code> and <code>weighted</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function computes pseudo values based on a first order Taylor
series, also known as the "infinitesimal jackknife" (IJ) or "dfbeta"
residuals.  To be completely correct these results could perhaps be
called `IJ pseudo values' or even pseudo psuedo-values.
For moderate to large data, however, the resulting values will
be almost identical, numerically, to the ordinary jackknife.</p>
<p>A primary advantage of this approach is computational speed.
Other features, neither good nor bad, are that they will agree with
robust standard errors of other survival package estimates,
which are based on the IJ, and that the mean of the estimates, over
subjects, is exactly the underlying survival estimate.</p>
<p>For the <code>type</code> variable, <code>surv</code> is an acceptable synonym for
<code>pstate</code>, and <code>rmst</code> and <code>rmts</code> are equivalent to <code>sojourn</code>.
All of these are case insensitive.</p>
<p>The result from this routine is simply n times the IJ value, where n is
the number of subjects.
(If the the <code>survfit</code> call included and <code>id</code> option, n is
the number of unique id values, otherwise the number of rows in the data set.) 
IJ values are well defined for all variants of the Aalen-Johansen
estimate, as computed by the <code>survfit</code> function; indeed, they are
the basis for standard errors of the result.
Understanding of the properties of the pseudo-values, however, is still
evolving.  Validity has been shown for the simplest case (Kaplan-Meier),
for competing risks, and for the corresponding sojourn times.
On the other hand, one must be careful when the data includes
left-truncation (P. K. Andersen, personal communication), and also with
pseudo-values for the cumulative hazard.
As understanding evolves, treat this routine's results as a reseach
tool, not production, for the more complex models.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A vector, matrix, or array.  The first dimension is always the number of
  observations in <code>fit</code> object, in the same order as the original
  data set (less any missing values that were removed when creating the
  survfit object);
  the second, if applicable, corresponds to <code>fit$states</code>, e.g.,
  multi-state
  survival, and the last dimension to the selected time points.
  (If there are multiple rows for a given id, there is only one
  pseudovalue per unique id.)</p>


<p>For the data.frame option, a data frame containing values for id,
  time, and pseudo.  If the original <code>survfit</code> call contained an</p>
<p></p>
<p><code>id</code> statement, then the values in the <code>id</code> column will be
  taken from that variable.  If the <code>id</code> statement has a simple
  form, e.g., <code>id = patno</code>, then the name of the id column will
  be `patno', otherwise it will be named `(id)'.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The code will be slightly faster if the <code>model=TRUE</code> option is
  used in the <code>survfit</code> call.  It may be essential if the
  survfit/pseudo pair is used inside another function.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>PK Andersen and M Pohar-Perme, Pseudo-observations in surivival
analysis, Stat Methods Medical Res, 2010; 19:71-99</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="residuals.survfit.html">residuals.survfit</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu">pseudo</span><span class="op">(</span><span class="va">fit1</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">730</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 228   2</span>
<span class="r-in"><span><span class="va">lfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">ph.ecog</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>, data<span class="op">=</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Restricted Mean Time in State (RMST) </span></span></span>
<span class="r-in"><span><span class="va">rms</span> <span class="op">&lt;-</span> <span class="fu">pseudo</span><span class="op">(</span><span class="va">fit1</span>, times<span class="op">=</span> <span class="fl">730</span>, type<span class="op">=</span><span class="st">'RMST'</span><span class="op">)</span> <span class="co"># 2 years</span></span></span>
<span class="r-in"><span><span class="va">rfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">rms</span> <span class="op">~</span> <span class="va">ph.ecog</span> <span class="op">+</span> <span class="va">sex</span>, data<span class="op">=</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rfit</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>ph.ecog<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, sex<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># print it out nicely</span></span></span>
<span class="r-in"><span><span class="va">temp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">rhat</span><span class="op">$</span><span class="va">fit</span>, <span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">rhat</span><span class="op">$</span><span class="va">se.fit</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">temp1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">temp2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">temp1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">temp2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">temp3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"ph.ecog"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male RMST"</span>, <span class="st">"(se)"</span>, <span class="st">"Female RMST"</span>, <span class="st">"(se)"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">temp3</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Male RMST (se) Female RMST (se)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog 0     393.7 28.6       510.6 31.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog 1     307.8 19.8       424.7 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog 2     221.9 29.7       338.8 33.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog 3     136.1 47.9       253.0 50.5</span>
<span class="r-in"><span><span class="co"># compare this to the fully non-parametric estimate</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">ph.ecog</span>, data<span class="op">=</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit2</span>, rmean<span class="op">=</span><span class="fl">730</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call: survfit(formula = Surv(time, status) ~ ph.ecog, data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 observation deleted due to missingness </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             n events rmean* se(rmean) median 0.95LCL 0.95UCL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog=0  63     37    429      32.2    394     348     574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog=1 113     82    366      22.4    306     268     429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog=2  50     44    256      30.0    199     156     288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog=3   1      1    118       0.0    118      NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     * restricted mean with upper limit =  730 </span>
<span class="r-in"><span><span class="co"># the estimate for ph.ecog=3 is very unstable (n=1), pseudovalues smooth it.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># In all the above we should be using the robust variance, e.g., svyglm, but</span></span></span>
<span class="r-in"><span><span class="co">#  a recommended package can't depend on external libraries.</span></span></span>
<span class="r-in"><span><span class="co"># See the vignette for a more complete exposition.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Terry M Therneau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

