<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Specifies a penalised spline basis for the predictor.
    This is done by fitting a comparatively small set of splines and
    penalising the integrated second derivative.
    Traditional smoothing splines use one basis per observation, but several
    authors have pointed out that the final results of the fit are 
    indistinguishable for any number of basis functions greater than about 
    2-3 times the degrees of freedom. 
    Eilers and Marx point out that if the basis functions are evenly spaced,
    this leads to significant computational simplification, they refer
    to the result as a p-spline."><title>Smoothing splines using a pspline basis — pspline • survival</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smoothing splines using a pspline basis — pspline"><meta property="og:description" content="Specifies a penalised spline basis for the predictor.
    This is done by fitting a comparatively small set of splines and
    penalising the integrated second derivative.
    Traditional smoothing splines use one basis per observation, but several
    authors have pointed out that the final results of the fit are 
    indistinguishable for any number of basis functions greater than about 
    2-3 times the degrees of freedom. 
    Eilers and Marx point out that if the basis functions are evenly spaced,
    this leads to significant computational simplification, they refer
    to the result as a p-spline."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-analysis.html">Example Analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/therneau/survival/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Smoothing splines using a pspline basis</h1>
      
      <div class="d-none name"><code>pspline.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Specifies a penalised spline basis for the predictor.
    This is done by fitting a comparatively small set of splines and
    penalising the integrated second derivative.
    Traditional smoothing splines use one basis per observation, but several
    authors have pointed out that the final results of the fit are 
    indistinguishable for any number of basis functions greater than about 
    2-3 times the degrees of freedom. 
    Eilers and Marx point out that if the basis functions are evenly spaced,
    this leads to significant computational simplification, they refer
    to the result as a p-spline.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pspline</span><span class="op">(</span><span class="va">x</span>, df<span class="op">=</span><span class="fl">4</span>, <span class="va">theta</span>, nterm<span class="op">=</span><span class="fl">2.5</span> <span class="op">*</span> <span class="va">df</span>, degree<span class="op">=</span><span class="fl">3</span>, eps<span class="op">=</span><span class="fl">0.1</span>, <span class="va">method</span>,</span>
<span>   Boundary.knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, intercept<span class="op">=</span><span class="cn">FALSE</span>, penalty<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">combine</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">psplineinverse</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>for psline: a covariate vector.
    The function does not apply to factor variables.
    For psplineinverse x will be the result of a pspline call.</p></dd>

  <dt>df</dt>
<dd><p>the desired degrees of freedom.
    One of the arguments <code>df</code> or <code>theta</code>' must be given, but not both.
    If <code>df=0</code>, then the AIC = (loglik -df) is used to choose an
    "optimal" degrees of freedom.  If AIC is chosen, then an optional
    argument `caic=T' can be used to specify the corrected AIC of
    Hurvich et. al.</p></dd>

  <dt>theta</dt>
<dd><p>roughness penalty for the fit.
    It is a monotone function of the degrees of freedom, with theta=1
    corresponding to a linear fit and theta=0 to an unconstrained fit
    of nterm degrees of freedom.</p></dd>

  <dt>nterm</dt>
<dd><p>number of splines in the basis</p></dd>

  <dt>degree</dt>
<dd><p>degree of splines</p></dd>

  <dt>eps</dt>
<dd><p>accuracy for <code>df</code></p></dd>

  <dt>method</dt>
<dd><p>the method for choosing the tuning parameter <code>theta</code>.
    If theta is given, then 'fixed' is assumed.
    If the degrees of freedom is given, then 'df' is assumed.
    If method='aic' then the degrees of freedom is chosen automatically using
    Akaike's information criterion.</p></dd>

  <dt>...</dt>
<dd><p>optional arguments to the control function</p></dd>

  <dt>Boundary.knots</dt>
<dd><p>the spline is linear beyond the boundary knots.
    These default to the range of the data.</p></dd>

  <dt>intercept</dt>
<dd><p>if TRUE, the basis functions include the intercept.</p></dd>

  <dt>penalty</dt>
<dd><p>if FALSE a large number of attributes having to do with
    penalized fits are excluded.  This is useful to create a pspline
    basis matrix for other uses.</p></dd>

  <dt>combine</dt>
<dd><p>an optional vector of increasing integers.  If two
    adjacent values of <code>combine</code> are equal, then the corresponding
    coefficients of the fit are forced to be equal.  This is useful for
    monotone fits, see the vignette for more details.</p></dd>

  </dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Object of class <code>pspline, coxph.penalty</code> containing the spline basis,
 with the appropriate attributes to be
 recognized as a penalized term by the coxph or survreg functions.</p>


<p>For psplineinverse the original x vector is reconstructed.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="coxph.html">coxph</a></code>,<code><a href="survreg.html">survreg</a></code>,<code><a href="ridge.html">ridge</a></code>,
  <code><a href="frailty.html">frailty</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Eilers, Paul H. and Marx, Brian D. (1996).
Flexible smoothing with B-splines and penalties.
    Statistical Science, 11, 89-121.</p>
<p>Hurvich, C.M. and Simonoff, J.S. and Tsai, Chih-Ling (1998).
Smoothing parameter selection in nonparametric regression using
        an improved Akaike information criterion,
JRSSB, volume 60, 271--293.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">lfit6</span> <span class="op">&lt;-</span> <span class="fu"><a href="survreg.html">survreg</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu">pspline</span><span class="op">(</span><span class="va">age</span>, df<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lung</span><span class="op">$</span><span class="va">age</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lfit6</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">'Age'</span>, ylab<span class="op">=</span><span class="st">"Spline prediction"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Cancer Data"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pspline-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">ph.ecog</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">ph.ecog</span> <span class="op">+</span> <span class="fu">pspline</span><span class="op">(</span><span class="va">age</span>,<span class="fl">3</span><span class="op">)</span>, <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">ph.ecog</span> <span class="op">+</span> <span class="fu">pspline</span><span class="op">(</span><span class="va">age</span>,<span class="fl">8</span><span class="op">)</span>, <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit0</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = Surv(time, status) ~ ph.ecog + age, data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef exp(coef) se(coef)     z        p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog 0.443485  1.558128 0.115831 3.829 0.000129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age     0.011281  1.011345 0.009319 1.211 0.226082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test=19.06  on 2 df, p=7.279e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n= 227, number of events= 164 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (1 observation deleted due to missingness)</span>
<span class="r-in"><span><span class="va">fit1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = Surv(time, status) ~ ph.ecog + pspline(age, 3), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             coef se(coef)      se2    Chisq   DF       p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog                  0.44802  0.11707  0.11678 14.64453 1.00 0.00013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pspline(age, 3), linear  0.01126  0.00928  0.00928  1.47231 1.00 0.22498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pspline(age, 3), nonlin                             2.07924 2.08 0.37143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iterations: 4 outer, 12 Newton-Raphson</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Theta= 0.861 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Degrees of freedom for terms= 1.0 3.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test=21.9  on 4.08 df, p=2e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n= 227, number of events= 164 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (1 observation deleted due to missingness)</span>
<span class="r-in"><span><span class="va">fit3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = Surv(time, status) ~ ph.ecog + pspline(age, 8), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             coef se(coef)      se2    Chisq   DF       p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ph.ecog                  0.47640  0.12024  0.11925 15.69732 1.00 7.4e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pspline(age, 8), linear  0.01172  0.00923  0.00923  1.61161 1.00    0.20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pspline(age, 8), nonlin                             6.93188 6.99    0.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iterations: 5 outer, 15 Newton-Raphson</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Theta= 0.691 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Degrees of freedom for terms= 1 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test=27.6  on 8.97 df, p=0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n= 227, number of events= 164 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (1 observation deleted due to missingness)</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Terry M Therneau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

