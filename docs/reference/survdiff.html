<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Tests if there is a difference between two or more survival curves using
the \(G^\rho\) family of tests, or for a single curve against a known alternative."><title>Test Survival Curve Differences — survdiff • survival</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Test Survival Curve Differences — survdiff"><meta property="og:description" content="Tests if there is a difference between two or more survival curves using
the \(G^\rho\) family of tests, or for a single curve against a known alternative."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-analysis.html">Example Analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/therneau/survival/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Test Survival Curve Differences</h1>
      
      <div class="d-none name"><code>survdiff.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Tests if there is a difference between two or more survival curves using
the \(G^\rho\) family of tests, or for a single curve against a known alternative.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">survdiff</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">subset</span>, <span class="va">na.action</span>, rho<span class="op">=</span><span class="fl">0</span>, timefix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>a formula expression as for other survival models, of the form
<code>Surv(time, status) ~ predictors</code>.  For a one-sample test, the predictors
must consist of a single <code>offset(sp)</code> term, where <code>sp</code> is a vector giving the
survival probability of each subject.  For a k-sample test, each unique
combination of predictors defines a subgroup.
A <code>strata</code> term may be used to produce a stratified test.
To cause missing values in the predictors to be treated as a separate
group, rather than being omitted, use the <code>strata</code> function with its
<code>na.group=T</code> argument.</p></dd>

<dt>data</dt>
<dd><p>an optional data frame in which to interpret the variables occurring in the
formula.</p></dd>

<dt>subset</dt>
<dd><p>expression indicating which subset of the rows of data should be used in
the fit.  This can be a logical vector (which is replicated to have
length equal to the number of observations), a numeric vector indicating
which observation numbers are to be included (or excluded if negative),
or a character vector of row names to be included.  All observations are
included by default.</p></dd>

<dt>na.action</dt>
<dd><p>a missing-data filter function.  This is applied to the <code>model.frame</code> after any
subset argument has been used.  Default is <code>options()$na.action</code>.</p></dd>

<dt>rho</dt>
<dd><p>a scalar parameter that controls the type of test.</p></dd>

<dt>timefix</dt>
<dd><p>process times through the <code>aeqSurv</code> function to
  eliminate potential roundoff issues.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list with components:</p>
<dl><dt>n</dt>
<dd><p>the number of subjects in each group.</p></dd>

<dt>obs</dt>
<dd><p>the weighted observed number of events in each group.
If there are strata, this will be a matrix with one column per stratum.</p></dd>

<dt>exp</dt>
<dd><p>the weighted expected number of events in each group.
If there are strata, this will be a matrix with one column per stratum.</p></dd>

<dt>chisq</dt>
<dd><p>the chisquare statistic for a test of equality.</p></dd>

<dt>var</dt>
<dd><p>the variance matrix of the test.</p></dd>

<dt>strata</dt>
<dd><p>optionally, the number of subjects contained in each stratum.</p></dd>

<dt>pvalue</dt>
<dd><p>the p-value corresponding to the Chisquare statistic</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a></h2>
    <p>This function implements the G-rho family of
Harrington and Fleming (1982), with weights on each death of \(S(t)^\rho\),
where \(S(t)\) is the Kaplan-Meier estimate of survival.
With <code>rho = 0</code> this is the log-rank or Mantel-Haenszel test,
and with <code>rho = 1</code> it is equivalent to the Peto &amp; Peto modification
of the Gehan-Wilcoxon test.</p>
<p>Peto and Peto show that the Gehan-Wilcoxon test can be badly biased if
the two groups have different censoring patterns, and proposed an
alternative.  Prentice and Marek later showed an actual example where this
issue occurs.  For most data sets the Gehan-Wilcoxon and
Peto-Peto-Prentice variant will hardly differ, however.</p>
<p>If the right hand side of the formula consists only of an offset term,
then a one sample test is done.
To cause missing values in the predictors to be treated as a separate
group, rather than being omitted, use the <code>factor</code> function with its
<code>exclude</code> argument to recode the righ-hand-side covariate.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Harrington, D. P. and Fleming, T. R. (1982).
A class of rank test procedures for censored survival data.
 Biometrika, 553-566.</p>
<p>Peto R. Peto and Peto, J. (1972) Asymptotically efficient rank invariant
  test procedures (with discussion), JRSSA, 185-206.</p>
<p>Prentice, R. and Marek, P. (1979)  A qualitative discrepancy between
  censored data rank tests, Biometics, 861--867.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Two-sample test</span></span></span>
<span class="r-in"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>,data<span class="op">=</span><span class="va">ovarian</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> survdiff(formula = Surv(futime, fustat) ~ rx, data = ovarian)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       N Observed Expected (O-E)^2/E (O-E)^2/V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rx=1 13        7     5.23     0.596      1.06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rx=2 13        5     6.77     0.461      1.06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Chisq= 1.1  on 1 degrees of freedom, p= 0.3 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Stratified 7-sample test</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">pat.karno</span> <span class="op">+</span> <span class="fu"><a href="strata.html">strata</a></span><span class="op">(</span><span class="va">inst</span><span class="op">)</span>, data<span class="op">=</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> survdiff(formula = Surv(time, status) ~ pat.karno + strata(inst), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lung)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n=224, 4 observations deleted due to missingness.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                N Observed Expected (O-E)^2/E (O-E)^2/V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=30   2        1    0.692   0.13720   0.15752</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=40   2        1    1.099   0.00889   0.00973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=50   4        4    1.166   6.88314   7.45359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=60  30       27   16.298   7.02790   9.57333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=70  41       31   26.358   0.81742   1.14774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=80  50       38   41.938   0.36978   0.60032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=90  60       38   47.242   1.80800   3.23078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pat.karno=100 35       21   26.207   1.03451   1.44067</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Chisq= 21.4  on 7 degrees of freedom, p= 0.003 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Expected survival for heart transplant patients based on</span></span></span>
<span class="r-in"><span><span class="co">## US mortality tables</span></span></span>
<span class="r-in"><span><span class="va">expect</span> <span class="op">&lt;-</span> <span class="fu"><a href="survexp.html">survexp</a></span><span class="op">(</span><span class="va">futime</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">jasa</span>, cohort<span class="op">=</span><span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                  rmap<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age<span class="op">=</span><span class="op">(</span><span class="va">accept.dt</span> <span class="op">-</span> <span class="va">birth.dt</span><span class="op">)</span>, sex<span class="op">=</span><span class="fl">1</span>, year<span class="op">=</span><span class="va">accept.dt</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  ratetable<span class="op">=</span><span class="va">survexp.us</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## actual survival is much worse (no surprise)</span></span></span>
<span class="r-in"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">jasa</span><span class="op">$</span><span class="va">futime</span>, <span class="va">jasa</span><span class="op">$</span><span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">expect</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> survdiff(formula = Surv(jasa$futime, jasa$fustat) ~ offset(expect))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed Expected        Z        p </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   75.000    0.644  -92.681    0.000 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The free light chain data set is close to the population.</span></span></span>
<span class="r-in"><span><span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu"><a href="survexp.html">survexp</a></span><span class="op">(</span><span class="va">futime</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">flchain</span>, cohort<span class="op">=</span><span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>              rmap<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age<span class="op">=</span> <span class="va">age</span><span class="op">*</span><span class="fl">365.25</span>, sex<span class="op">=</span><span class="va">sex</span>, </span></span>
<span class="r-in"><span>                         year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sample.yr</span>, <span class="st">"-07-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              ratetable<span class="op">=</span> <span class="va">survexp.mn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu"><a href="Surv.html">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">e2</span><span class="op">)</span>, <span class="va">flchain</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> survdiff(formula = Surv(futime, death) ~ offset(e2), data = flchain)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Observed  Expected         Z         p </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2169.0000 2073.9133   -2.0880    0.0368 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Terry M Therneau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

